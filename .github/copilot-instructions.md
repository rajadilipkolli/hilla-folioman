## Quick context

This repository is a Hilla (Vaadin + Spring Boot) full‑stack application for mutual fund portfolio management (Java 21 backend, React frontend built with Vite/Hilla). The backend is a Spring Boot app and the frontend lives in `src/main/frontend/` (generated client code in `src/main/frontend/generated`).

Keep edits minimal and preserve generated code under `src/main/frontend/generated` unless intentionally regenerating client stubs.

## Big picture (what to know first)

- Backend: Spring Boot (entry under `src/main/java/com/app/folioman/Application.java`) with domain packages like `portfolio`, `mfschemes`, etc. Server configuration lives in `src/main/resources/application.properties` and profile variants.
- Frontend: React app wired with Hilla under `src/main/frontend/`. Routes are defined in `src/main/frontend/routes.tsx` and the app bootstraps from `src/main/frontend/index.ts`.
- Generated client code: `src/main/frontend/generated/` contains Hilla-generated controllers (e.g. `endpoints.ts`, `connect-client.default.ts`). These are produced by the build/generation step — do not hand-edit unless you control the generator.
- Persistence & infra: Postgres (JDBC), MongoDB (JobRunr), Redis for caching. See `pom.xml` and `src/main/resources/application.properties` for settings and feature flags (JobRunr, tracing, observability).

## How to build, run & test (developer workflows)

- Common (Windows PowerShell): use the Maven wrapper in repo root (`mvnw.cmd`). Examples:

```
.\mvnw.cmd clean verify                # runs unit + integration (failsafe) via default lifecycle
.\mvnw.cmd spring-boot:run -Dspring-boot.run.profiles=local   # run app with 'local' profile
.\mvnw.cmd clean package -Pproduction  # production bundle
```

- Local infra: the repo includes a `docker/docker-compose.yml` for Postgres/Mongo/Redis. Start it before running the app during development:

```
docker-compose -f docker/docker-compose.yml up -d
```

- Frontend generation and prepare step is integrated into the Maven build via the Vaadin plugin. Running the Maven build will update generated frontend artifacts. If you change server DTOs or endpoints, re-run the Maven build to regenerate `src/main/frontend/generated`.

- Formatting: Java + TypeScript are managed with Spotless via Maven. To apply formatters locally:

```
.\mvnw.cmd spotless:apply
```

- Tests: Unit tests are run by Surefire; integration tests are recognized by naming conventions and run by Failsafe. Conventions (from `pom.xml`):
  - Integration tests include patterns `*IT*`, `*IntTest*`, `*IntegrationTest*` (Failsafe)
  - Unit tests are run by Surefire (exclude integration patterns)
  - Testcontainers are used (see `spring-boot-testcontainers` dependency and `spring.testcontainers.beans.startup=parallel` property)

- Quick dev tip: `src/test/java/com/app/folioman/TestApplication.java` can be launched from an IDE to exercise Testcontainers-powered integration startup quickly.

## Conventions and patterns to follow (project-specific)

- Generated files: Many frontend stubs are generated by Hilla. Files under `src/main/frontend/generated/` and `src/main/frontend/generated/*.generated.js` are build outputs. Avoid editing them manually.
- Formatting: Spotless is enforced during the Maven compile lifecycle. TypeScript prettier config ignores `src/main/frontend/generated/` (see `pom.xml`).
- Client/Server wiring: Server endpoints that are exposed to the frontend have generated wrappers under `src/main/frontend/generated` (example: `ImportMutualFundController.ts`, `endpoints.ts`). When changing server-side endpoint signatures, expect frontend stubs to be regenerated.
- Tests naming: Use the project's test naming conventions so tests run in the correct phase (unit vs integration). See `maven-surefire-plugin` and `maven-failsafe-plugin` configuration in `pom.xml`.

## Integration points & external dependencies

- Data stores: PostgreSQL (primary), MongoDB (JobRunr), Redis (cache). Configurable via environment vars: `PORT`, `MONGODB_URI`, etc. See `src/main/resources/application.properties`.
- Background jobs: JobRunr is used (dashboard enabled by default in config). Database for jobs is MongoDB by default.
- Observability: Micrometer + OpenTelemetry exporter are configured (OTLP endpoint default `http://localhost:4318/v1/traces`) and management endpoints are exposed.
- CAS PDF processing: The README requires a Python CLI `casparser` for password-protected CAS PDF processing. The PDF upload/import feature will not work without installing that external dependency (`pip install casparser`).

## Files & locations worth referencing in code changes

- Backend entry & config: `src/main/java/com/app/folioman/Application.java`, `src/main/resources/application.properties`
- Backend packages: `src/main/java/com/app/folioman/**` (look for `portfolio`, `mfschemes`, controllers)
- Frontend entry & routes: `src/main/frontend/index.ts`, `src/main/frontend/index.html`, `src/main/frontend/routes.tsx`
- Generated client code: `src/main/frontend/generated/` (do not hand-edit)
- Build & formatting: `pom.xml` (Spotless, vaadin plugin, surefire/failsafe), `package.json` (frontend deps)
- Local docker setup: `docker/docker-compose.yml`
- Tests: `src/test/java/com/app/folioman/` (including `TestApplication.java`)

## Editing guidance for AI code agents

- Prefer editing domain code under `src/main/java/com/app/folioman/` and non-generated frontend files under `src/main/frontend/` (except `generated`).
- If a change affects server DTOs or endpoints, include the step to rebuild so generated client artifacts are refreshed. Example sequence: modify server DTOs -> run `mvnw.cmd package` -> inspect `src/main/frontend/generated` for updates.
- Preserve or update Maven/Spotless configuration only with good reason; formatting is enforced in CI.
- When adding new integration tests, follow naming conventions so Failsafe picks them up (use `*IT*` or `*IntegrationTest*`).

## Minimal example edits (how to change an endpoint safely)

1. Update server controller/DTO in `src/main/java/...`
2. Run the Maven prepare/build to regenerate frontend stubs: `.\mvnw.cmd -DskipTests=false package` (or run full build `clean verify`)
3. Update or adapt frontend code in `src/main/frontend/` (non-generated files). Do not hand-edit `generated` files unless regenerating.
